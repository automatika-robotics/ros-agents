
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="cQVj-BaADcGVOGB7GOvfbkgJjxni10C2fYWCZ03jOeo" name="google-site-verification" />

    <title>Bringing it all together ü§ñ &#8212; ROS Agents 0.3.3 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=94d292f4"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/complete';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Making the System Robust And Production Ready" href="multiprocessing.html" />
    <link rel="prev" title="Create a semantic router to route text queries between different components" href="semantic_router.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.3.3" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/ROS_AGENTS_DARK.png" class="logo__image only-light" alt="ROS Agents 0.3.3 documentation - Home"/>
    <img src="../_static/ROS_AGENTS.png" class="logo__image only-dark pst-js-only" alt="ROS Agents 0.3.3 documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://automatikarobotics.com/" title="Automatika" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/automatika-logo.png" class="icon-link-image" alt="Automatika"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/automatika-robotics/ros-agents" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/cAW3BWwt" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">ROS Agents  ü§ñ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation üõ†Ô∏è</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start üöÄ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic Concepts üìö</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Examples ‚ú®</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conversational.html">Create a conversational agent with audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="prompt_engineering.html">Prompt engineering for LLMs/MLLMs using vision models</a></li>
<li class="toctree-l2"><a class="reference internal" href="semantic_map.html">Create a spatio-temporal semantic map</a></li>
<li class="toctree-l2"><a class="reference internal" href="goto.html">Create a Go-to-X component using map data</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_calling.html">Use Tool Calling in Go-to-X</a></li>
<li class="toctree-l2"><a class="reference internal" href="semantic_router.html">Create a semantic router to route text queries between different components</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Bringing it all together ü§ñ</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiprocessing.html">Making the System Robust And Production Ready</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../apidocs/index.html">API Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/agents/agents.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.clients.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.clients</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.components.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.components</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.vectordbs.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.vectordbs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.ros.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.ros</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.models.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.models</span></code></a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/automatika-robotics/ros-agents/blob/main/docs/examples/complete.md?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/automatika-robotics/ros-agents/edit/main/docs/examples/complete.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/automatika-robotics/ros-agents/issues/new?title=Issue%20on%20page%20%2Fexamples/complete.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/examples/complete.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Bringing it all together ü§ñ</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="bringing-it-all-together">
<h1>Bringing it all together ü§ñ<a class="headerlink" href="#bringing-it-all-together" title="Link to this heading">#</a></h1>
<p>In this example we will combine everything we implemented in the previous examples to create one big graph of components. Afterwards we will analyze what we have accomplished. Here is what the code looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">agents.components</span> <span class="kn">import</span> <span class="n">MLLM</span><span class="p">,</span> <span class="n">SpeechToText</span><span class="p">,</span> <span class="n">TextToSpeech</span><span class="p">,</span> <span class="n">LLM</span><span class="p">,</span> <span class="n">Vision</span><span class="p">,</span> <span class="n">MapEncoding</span><span class="p">,</span> <span class="n">SemanticRouter</span>
<span class="kn">from</span> <span class="nn">agents.config</span> <span class="kn">import</span> <span class="n">SpeechToTextConfig</span><span class="p">,</span> <span class="n">TextToSpeechConfig</span>
<span class="kn">from</span> <span class="nn">agents.clients.roboml</span> <span class="kn">import</span> <span class="n">HTTPModelClient</span><span class="p">,</span> <span class="n">RESPModelClient</span><span class="p">,</span> <span class="n">HTTPDBClient</span>
<span class="kn">from</span> <span class="nn">agents.clients.ollama</span> <span class="kn">import</span> <span class="n">OllamaClient</span>
<span class="kn">from</span> <span class="nn">agents.models</span> <span class="kn">import</span> <span class="n">Whisper</span><span class="p">,</span> <span class="n">SpeechT5</span><span class="p">,</span> <span class="n">Llava</span><span class="p">,</span> <span class="n">Llama3_1</span><span class="p">,</span> <span class="n">VisionModel</span>
<span class="kn">from</span> <span class="nn">agents.vectordbs</span> <span class="kn">import</span> <span class="n">ChromaDB</span>
<span class="kn">from</span> <span class="nn">agents.config</span> <span class="kn">import</span> <span class="n">VisionConfig</span><span class="p">,</span> <span class="n">LLMConfig</span><span class="p">,</span> <span class="n">MapConfig</span><span class="p">,</span> <span class="n">SemanticRouterConfig</span>
<span class="kn">from</span> <span class="nn">agents.ros</span> <span class="kn">import</span> <span class="n">Topic</span><span class="p">,</span> <span class="n">Launcher</span><span class="p">,</span> <span class="n">FixedInput</span><span class="p">,</span> <span class="n">MapLayer</span><span class="p">,</span> <span class="n">Route</span>


<span class="c1">### Setup our models and vectordb ###</span>
<span class="n">whisper</span> <span class="o">=</span> <span class="n">Whisper</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;whisper&quot;</span><span class="p">)</span>
<span class="n">whisper_client</span> <span class="o">=</span> <span class="n">HTTPModelClient</span><span class="p">(</span><span class="n">whisper</span><span class="p">)</span>
<span class="n">speecht5</span> <span class="o">=</span> <span class="n">SpeechT5</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;speecht5&quot;</span><span class="p">)</span>
<span class="n">speecht5_client</span> <span class="o">=</span> <span class="n">HTTPModelClient</span><span class="p">(</span><span class="n">speecht5</span><span class="p">)</span>
<span class="n">object_detection_model</span> <span class="o">=</span> <span class="n">VisionModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;dino_4scale&quot;</span><span class="p">,</span>
                               <span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;dino-4scale_r50_8xb2-12e_coco&quot;</span><span class="p">)</span>
<span class="n">detection_client</span> <span class="o">=</span> <span class="n">RESPModelClient</span><span class="p">(</span><span class="n">object_detection_model</span><span class="p">)</span>
<span class="n">llava</span> <span class="o">=</span> <span class="n">Llava</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llava&quot;</span><span class="p">)</span>
<span class="n">llava_client</span> <span class="o">=</span> <span class="n">OllamaClient</span><span class="p">(</span><span class="n">llava</span><span class="p">)</span>
<span class="n">llama</span> <span class="o">=</span> <span class="n">Llama3_1</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llama&quot;</span><span class="p">)</span>
<span class="n">llama_client</span> <span class="o">=</span> <span class="n">OllamaClient</span><span class="p">(</span><span class="n">llama</span><span class="p">)</span>
<span class="n">chroma</span> <span class="o">=</span> <span class="n">ChromaDB</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MainDB&quot;</span><span class="p">)</span>
<span class="n">chroma_client</span> <span class="o">=</span> <span class="n">HTTPDBClient</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">chroma</span><span class="p">)</span>

<span class="c1">### Setup our components ###</span>
<span class="c1"># Setup a speech to text component</span>
<span class="n">audio_in</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;audio0&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;Audio&quot;</span><span class="p">)</span>
<span class="n">query_topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;question&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>

<span class="n">speech_to_text</span> <span class="o">=</span> <span class="n">SpeechToText</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">audio_in</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">query_topic</span><span class="p">],</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">whisper_client</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="n">audio_in</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">SpeechToTextConfig</span><span class="p">(</span><span class="n">enable_vad</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>  <span class="c1"># option to always listen for speech through the microphone</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;speech_to_text&quot;</span>
<span class="p">)</span>

<span class="c1"># Setup a text to speech component</span>
<span class="n">query_answer</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>

<span class="n">t2s_config</span> <span class="o">=</span> <span class="n">TextToSpeechConfig</span><span class="p">(</span><span class="n">play_on_device</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">text_to_speech</span> <span class="o">=</span> <span class="n">TextToSpeech</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">query_answer</span><span class="p">],</span>
    <span class="n">trigger</span><span class="o">=</span><span class="n">query_answer</span><span class="p">,</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">speecht5_client</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">t2s_config</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;text_to_speech&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Setup a vision component for object detection</span>
<span class="n">image0</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;image_raw&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>
<span class="n">detections_topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;detections&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;Detections&quot;</span><span class="p">)</span>

<span class="n">detection_config</span> <span class="o">=</span> <span class="n">VisionConfig</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">vision</span> <span class="o">=</span> <span class="n">Vision</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">image0</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">detections_topic</span><span class="p">],</span>
    <span class="n">trigger</span><span class="o">=</span><span class="n">image0</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">detection_config</span><span class="p">,</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">detection_client</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;object_detection&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Define a generic mllm component for vqa</span>
<span class="n">mllm_query</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;mllm_query&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>

<span class="n">mllm</span> <span class="o">=</span> <span class="n">MLLM</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">mllm_query</span><span class="p">,</span> <span class="n">image0</span><span class="p">,</span> <span class="n">detections_topic</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">query_answer</span><span class="p">],</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">llava_client</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="n">mllm_query</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;visual_q_and_a&quot;</span>
<span class="p">)</span>

<span class="n">mllm</span><span class="o">.</span><span class="n">set_component_prompt</span><span class="p">(</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Imagine you are a robot.</span>
<span class="s2">    This image has following items: {{ detections }}.</span>
<span class="s2">    Answer the following about this image: {{ text0 }}&quot;&quot;&quot;</span>
<span class="p">)</span>

<span class="c1"># Define a fixed input mllm component that does introspection</span>
<span class="n">introspection_query</span> <span class="o">=</span> <span class="n">FixedInput</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;introspection_query&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
    <span class="n">fixed</span><span class="o">=</span><span class="s2">&quot;What kind of a room is this? Is it an office, a bedroom or a kitchen? Give a one word answer, out of the given choices&quot;</span><span class="p">)</span>
<span class="n">introspection_answer</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;introspection_answer&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>

<span class="n">introspector</span> <span class="o">=</span> <span class="n">MLLM</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">introspection_query</span><span class="p">,</span> <span class="n">image0</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">introspection_answer</span><span class="p">],</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">llava_client</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;introspector&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">introspection_validation</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;office&quot;</span><span class="p">,</span> <span class="s2">&quot;bedroom&quot;</span><span class="p">,</span> <span class="s2">&quot;kitchen&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">option</span>


<span class="n">introspector</span><span class="o">.</span><span class="n">add_publisher_preprocessor</span><span class="p">(</span><span class="n">introspection_answer</span><span class="p">,</span> <span class="n">introspection_validation</span><span class="p">)</span>

<span class="c1"># Define a semantic map using MapEncoding component</span>
<span class="n">layer1</span> <span class="o">=</span> <span class="n">MapLayer</span><span class="p">(</span><span class="n">subscribes_to</span><span class="o">=</span><span class="n">detections_topic</span><span class="p">,</span> <span class="n">temporal_change</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">layer2</span> <span class="o">=</span> <span class="n">MapLayer</span><span class="p">(</span><span class="n">subscribes_to</span><span class="o">=</span><span class="n">introspection_answer</span><span class="p">,</span> <span class="n">resolution_multiple</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">position</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;odom&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;Odometry&quot;</span><span class="p">)</span>
<span class="n">map_topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;OccupancyGrid&quot;</span><span class="p">)</span>

<span class="n">map_conf</span> <span class="o">=</span> <span class="n">MapConfig</span><span class="p">(</span><span class="n">map_name</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">)</span>
<span class="nb">map</span> <span class="o">=</span> <span class="n">MapEncoding</span><span class="p">(</span>
    <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">layer1</span><span class="p">,</span> <span class="n">layer2</span><span class="p">],</span>
    <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
    <span class="n">map_topic</span><span class="o">=</span><span class="n">map_topic</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">map_conf</span><span class="p">,</span>
    <span class="n">db_client</span><span class="o">=</span><span class="n">chroma_client</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;map_encoder&quot;</span>
<span class="p">)</span>

<span class="c1"># Define a generic LLM component</span>
<span class="n">llm_query</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llm_query&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">llm_query</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">query_answer</span><span class="p">],</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">llama_client</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="p">[</span><span class="n">llm_query</span><span class="p">],</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;general_q_and_a&quot;</span>
<span class="p">)</span>

<span class="c1"># Define a Go-to-X component using LLM</span>
<span class="n">goto_query</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;goto_query&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>
<span class="n">goal_point</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;goal_point&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;PoseStamped&quot;</span><span class="p">)</span>

<span class="n">goto_config</span> <span class="o">=</span> <span class="n">LLMConfig</span><span class="p">(</span>
    <span class="n">enable_rag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span>
    <span class="n">distance_func</span><span class="o">=</span><span class="s2">&quot;l2&quot;</span><span class="p">,</span>
    <span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">add_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">goto</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">goto_query</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">goal_point</span><span class="p">],</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">llama_client</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">goto_config</span><span class="p">,</span>
    <span class="n">db_client</span><span class="o">=</span><span class="n">chroma_client</span><span class="p">,</span>
    <span class="n">trigger</span><span class="o">=</span><span class="n">goto_query</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;go_to_x&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">goto</span><span class="o">.</span><span class="n">set_component_prompt</span><span class="p">(</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;From the given metadata, extract coordinates and provide</span>
<span class="s2">    the coordinates in the following json format:</span><span class="se">\n</span><span class="s2"> {&quot;position&quot;: coordinates}&quot;&quot;&quot;</span>
<span class="p">)</span>


<span class="c1"># pre-process the output before publishing to a topic of msg_type PoseStamped</span>
<span class="k">def</span> <span class="nf">llm_answer_to_goal_point</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="c1"># extract the json part of the output string (including brackets)</span>
    <span class="c1"># one can use sophisticated regex parsing here but we&#39;ll keep it simple</span>
    <span class="n">json_string</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># load the string as a json and extract position coordinates</span>
    <span class="c1"># if there is an error, return None, i.e. no output would be published to goal_point</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coordinates Extracted:&#39;</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># sometimes LLMs avoid adding the zeros of z-dimension</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coordinates</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span>


<span class="n">goto</span><span class="o">.</span><span class="n">add_publisher_preprocessor</span><span class="p">(</span><span class="n">goal_point</span><span class="p">,</span> <span class="n">llm_answer_to_goal_point</span><span class="p">)</span>

<span class="c1"># Define a semantic router between a generic LLM component, VQA MLLM component and Go-to-X component</span>
<span class="n">goto_route</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">routes_to</span><span class="o">=</span><span class="n">goto_query</span><span class="p">,</span>
    <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Go to the door&quot;</span><span class="p">,</span> <span class="s2">&quot;Go to the kitchen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Get me a glass&quot;</span><span class="p">,</span> <span class="s2">&quot;Fetch a ball&quot;</span><span class="p">,</span> <span class="s2">&quot;Go to hallway&quot;</span><span class="p">])</span>

<span class="n">llm_route</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">routes_to</span><span class="o">=</span><span class="n">llm_query</span><span class="p">,</span>
    <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span> <span class="s2">&quot;Is there life on Mars?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;How many tablespoons in a cup?&quot;</span><span class="p">,</span> <span class="s2">&quot;How are you today?&quot;</span><span class="p">,</span> <span class="s2">&quot;Whats up?&quot;</span><span class="p">])</span>

<span class="n">mllm_route</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">routes_to</span><span class="o">=</span><span class="n">mllm_query</span><span class="p">,</span>
    <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Are we indoors or outdoors&quot;</span><span class="p">,</span> <span class="s2">&quot;What do you see?&quot;</span><span class="p">,</span> <span class="s2">&quot;Whats in front of you?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Where are we&quot;</span><span class="p">,</span> <span class="s2">&quot;Do you see any people?&quot;</span><span class="p">,</span> <span class="s2">&quot;How many things are infront of you?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Is this room occupied?&quot;</span><span class="p">])</span>

<span class="n">router_config</span> <span class="o">=</span> <span class="n">SemanticRouterConfig</span><span class="p">(</span><span class="n">router_name</span><span class="o">=</span><span class="s2">&quot;go-to-router&quot;</span><span class="p">,</span> <span class="n">distance_func</span><span class="o">=</span><span class="s2">&quot;l2&quot;</span><span class="p">)</span>
<span class="c1"># Initialize the router component</span>
<span class="n">router</span> <span class="o">=</span> <span class="n">SemanticRouter</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">query_topic</span><span class="p">],</span>
    <span class="n">routes</span><span class="o">=</span><span class="p">[</span><span class="n">llm_route</span><span class="p">,</span> <span class="n">goto_route</span><span class="p">,</span> <span class="n">mllm_route</span><span class="p">],</span>
    <span class="n">default_route</span><span class="o">=</span><span class="n">llm_route</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">router_config</span><span class="p">,</span>
    <span class="n">db_client</span><span class="o">=</span><span class="n">chroma_client</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s1">&#39;router&#39;</span>
<span class="p">)</span>

<span class="c1"># Launch the components</span>
<span class="n">launcher</span> <span class="o">=</span> <span class="n">Launcher</span><span class="p">()</span>
<span class="n">launcher</span><span class="o">.</span><span class="n">add_pkg</span><span class="p">(</span>
    <span class="n">components</span><span class="o">=</span><span class="p">[</span>
        <span class="n">mllm</span><span class="p">,</span>
        <span class="n">llm</span><span class="p">,</span>
        <span class="n">goto</span><span class="p">,</span>
        <span class="n">introspector</span><span class="p">,</span>
        <span class="nb">map</span><span class="p">,</span>
        <span class="n">router</span><span class="p">,</span>
        <span class="n">speech_to_text</span><span class="p">,</span>
        <span class="n">text_to_speech</span><span class="p">,</span>
        <span class="n">vision</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">launcher</span><span class="o">.</span><span class="n">bringup</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note how we use the same model for <em>general_q_and_a</em> and <em>goto_to_x</em> components. Similarly <em>visual_q_and_a</em> and <em>introspector</em> components share a multimodal LLM model.</p>
</div>
<p>In this small code block above, we have setup a fairly sophisticated embodied agent with the following capabilities.</p>
<ul class="simple">
<li><p>A conversational interface using speech-to-text and text-to-speech models that uses the robots microphone and playback speaker.</p></li>
<li><p>The ability to answer contextual queries based on the robots camera, using an MLLM model.</p></li>
<li><p>The ability to answer generic queries, using an LLM model.</p></li>
<li><p>A semantic map of the robots observations, that acts as a spatio-temporal memory.</p></li>
<li><p>The ability to respond to Go-to-X commands utilizing the semantic map.</p></li>
<li><p>A single input interface that routes the input to different models based on its content.</p></li>
</ul>
<p>We can visualize the complete graph in the following diagram:</p>
<figure class="align-center" id="id1">
<img alt="Complete embodied agent" class="only-dark" src="../_images/complete_dark.png" />
<figcaption>
<p><span class="caption-text">Complete embodied agent graph</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id2">
<img alt="Complete embodied agent" class="only-light" src="../_images/complete_light.png" />
<figcaption>
<p><span class="caption-text">Complete embodied agent graph</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="semantic_router.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Create a semantic router to route text queries between different components</p>
      </div>
    </a>
    <a class="right-next"
       href="multiprocessing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Making the System Robust And Production Ready</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Automatika Robotics
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2025, Automatika Robotics.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>