
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="cQVj-BaADcGVOGB7GOvfbkgJjxni10C2fYWCZ03jOeo" name="google-site-verification" />

    <title>Create a Go-to-X component using map data &#8212; ROS Agents 0.3.3 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=94d292f4"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/goto';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Use Tool Calling in Go-to-X" href="tool_calling.html" />
    <link rel="prev" title="Create a spatio-temporal semantic map" href="semantic_map.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.3.3" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/ROS_AGENTS_DARK.png" class="logo__image only-light" alt="ROS Agents 0.3.3 documentation - Home"/>
    <img src="../_static/ROS_AGENTS.png" class="logo__image only-dark pst-js-only" alt="ROS Agents 0.3.3 documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://automatikarobotics.com/" title="Automatika" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/automatika-logo.png" class="icon-link-image" alt="Automatika"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/automatika-robotics/ros-agents" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/cAW3BWwt" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">ROS Agents  ü§ñ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation üõ†Ô∏è</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start üöÄ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic Concepts üìö</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Examples ‚ú®</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conversational.html">Create a conversational agent with audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="prompt_engineering.html">Prompt engineering for LLMs/MLLMs using vision models</a></li>
<li class="toctree-l2"><a class="reference internal" href="semantic_map.html">Create a spatio-temporal semantic map</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Create a Go-to-X component using map data</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_calling.html">Use Tool Calling in Go-to-X</a></li>
<li class="toctree-l2"><a class="reference internal" href="semantic_router.html">Create a semantic router to route text queries between different components</a></li>
<li class="toctree-l2"><a class="reference internal" href="complete.html">Bringing it all together ü§ñ</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiprocessing.html">Making the System Robust And Production Ready</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../apidocs/index.html">API Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/agents/agents.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.clients.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.clients</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.components.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.components</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.vectordbs.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.vectordbs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.ros.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.ros</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/agents/agents.models.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">agents.models</span></code></a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/automatika-robotics/ros-agents/blob/main/docs/examples/goto.md?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/automatika-robotics/ros-agents/edit/main/docs/examples/goto.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/automatika-robotics/ros-agents/issues/new?title=Issue%20on%20page%20%2Fexamples/goto.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/examples/goto.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Create a Go-to-X component using map data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-the-component">Initialize the component</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-process-the-model-output-before-publishing">Pre-process the model output before publishing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#launching-the-components">Launching the Components</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="create-a-go-to-x-component-using-map-data">
<h1>Create a Go-to-X component using map data<a class="headerlink" href="#create-a-go-to-x-component-using-map-data" title="Link to this heading">#</a></h1>
<p>In the previous <a class="reference internal" href="semantic_map.html"><span class="std std-doc">example</span></a> we created a semantic map using the MapEncoding component. Intuitively one can imagine that using the map data would require some form of RAG. Let us suppose that we want to create a Go-to-X component, which, when given a command like ‚ÄòGo to the yellow door‚Äô, would retreive the coordinates of the <em>yellow door</em> from the map and publish them to a goal point topic of type <em>PoseStamped</em> to be handled by our robots navigation system. We will create our Go-to-X component using the LLM component provided by ROS Agents. We will start by initializing the component, and configuring it to use RAG.</p>
<section id="initialize-the-component">
<h2>Initialize the component<a class="headerlink" href="#initialize-the-component" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agents.components</span> <span class="kn">import</span> <span class="n">LLM</span>
<span class="kn">from</span> <span class="nn">agents.models</span> <span class="kn">import</span> <span class="n">Llama3_1</span>
<span class="kn">from</span> <span class="nn">agents.config</span> <span class="kn">import</span> <span class="n">LLMConfig</span>
<span class="kn">from</span> <span class="nn">agents.clients.ollama</span> <span class="kn">import</span> <span class="n">OllamaClient</span>
<span class="kn">from</span> <span class="nn">agents.ros</span> <span class="kn">import</span> <span class="n">Topic</span>

<span class="c1"># Start a Llama3.1 based llm component using ollama client</span>
<span class="n">llama</span> <span class="o">=</span> <span class="n">Llama3_1</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llama&quot;</span><span class="p">)</span>
<span class="n">llama_client</span> <span class="o">=</span> <span class="n">OllamaClient</span><span class="p">(</span><span class="n">llama</span><span class="p">)</span>

<span class="c1"># Define LLM input and output topics including goal_point topic of type PoseStamped</span>
<span class="n">goto_in</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;goto_in&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>
<span class="n">goal_point</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;goal_point&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;PoseStamped&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to configure the component to use RAG, we will set the following options in its config.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">LLMConfig</span><span class="p">(</span><span class="n">enable_rag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span>
                   <span class="n">distance_func</span><span class="o">=</span><span class="s2">&quot;l2&quot;</span><span class="p">,</span>
                   <span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">add_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the <em>collection_name</em> parameter is the same as the map name we set in the previous <a class="reference internal" href="semantic_map.html"><span class="std std-doc">example</span></a>. We have also set <em>add_metadata</em> parameter to true to make sure that our metadata is included in the RAG result, as the spatial coordinates we want to get are part of the metadata. Let us have a quick look at the metadata stored in the map by the MapEncoding component.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="s2">&quot;layer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Topic_Name&quot;</span><span class="p">,</span>  <span class="c1"># same as topic name that the layer is subscribed to</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1234567</span><span class="p">,</span>
    <span class="s2">&quot;temporal_change&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this information, we will first initialize our component.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In the following code block we are using the same DB client that was setup in the previous <a class="reference internal" href="semantic_map.html"><span class="std std-doc">example</span></a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize the component</span>
<span class="n">goto</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">goto_in</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">goal_point</span><span class="p">],</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">llama_client</span><span class="p">,</span>
    <span class="n">db_client</span><span class="o">=</span><span class="n">chroma_client</span><span class="p">,</span>  <span class="c1"># check the previous example where we setup this database client</span>
    <span class="n">trigger</span><span class="o">=</span><span class="n">goto_in</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s1">&#39;go_to_x&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pre-process-the-model-output-before-publishing">
<h2>Pre-process the model output before publishing<a class="headerlink" href="#pre-process-the-model-output-before-publishing" title="Link to this heading">#</a></h2>
<p>Knowing that the output of retreival will be appended to the beggining of our query as context, we will setup a component level promot for our LLM.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># set a component prompt</span>
<span class="n">goto</span><span class="o">.</span><span class="n">set_component_prompt</span><span class="p">(</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;From the given metadata, extract coordinates and provide</span>
<span class="s2">    the coordinates in the following json format:</span><span class="se">\n</span><span class="s2"> {&quot;position&quot;: coordinates}&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One might notice that we have not used an input topic name in our prompt. This is because we only need the input topic to fetch data from the vector DB during the RAG step. The query to the LLM in this case would only be composed of data fetched from the DB and our prompt.</p>
</div>
<p>As the LLM output will contain text other than the <em>json</em> string that we have asked for, we need to add a pre-processing function to the output topic that extracts the required part of the text and returns the output in a format that can be published to a <em>PoseStamped</em> topic, i.e. a numpy array of floats.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># pre-process the output before publishing to a topic of msg_type PoseStamped</span>
<span class="k">def</span> <span class="nf">llm_answer_to_goal_point</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="c1"># extract the json part of the output string (including brackets)</span>
    <span class="c1"># one can use sophisticated regex parsing here but we&#39;ll keep it simple</span>
    <span class="n">json_string</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># load the string as a json and extract position coordinates</span>
    <span class="c1"># if there is an error, return None, i.e. no output would be published to goal_point</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coordinates Extracted:&#39;</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># sometimes LLMs avoid adding the zeros of z-dimension</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coordinates</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span>

<span class="c1"># add the pre-processing function to the goal_point output topic</span>
<span class="n">goto</span><span class="o">.</span><span class="n">add_publisher_preprocessor</span><span class="p">(</span><span class="n">goal_point</span><span class="p">,</span> <span class="n">llm_answer_to_goal_point</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="launching-the-components">
<h2>Launching the Components<a class="headerlink" href="#launching-the-components" title="Link to this heading">#</a></h2>
<p>And we will launch our Go-to-X component.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agents.ros</span> <span class="kn">import</span> <span class="n">Launcher</span>

<span class="c1"># Launch the component</span>
<span class="n">launcher</span> <span class="o">=</span> <span class="n">Launcher</span><span class="p">()</span>
<span class="n">launcher</span><span class="o">.</span><span class="n">add_pkg</span><span class="p">(</span>
    <span class="n">components</span><span class="o">=</span><span class="p">[</span><span class="n">goto</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">launcher</span><span class="o">.</span><span class="n">bringup</span><span class="p">()</span>
</pre></div>
</div>
<p>And that is all. Our Go-to-X component is ready. The complete code for this example is given below:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Go-to-X Component</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">agents.components</span> <span class="kn">import</span> <span class="n">LLM</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">agents.models</span> <span class="kn">import</span> <span class="n">Llama3_1</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">agents.vectordbs</span> <span class="kn">import</span> <span class="n">ChromaDB</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">agents.config</span> <span class="kn">import</span> <span class="n">LLMConfig</span>
<span class="linenos"> 8</span><span class="kn">from</span> <span class="nn">agents.clients.roboml</span> <span class="kn">import</span> <span class="n">HTTPDBClient</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">agents.clients.ollama</span> <span class="kn">import</span> <span class="n">OllamaClient</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">agents.ros</span> <span class="kn">import</span> <span class="n">Launcher</span><span class="p">,</span> <span class="n">Topic</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Start a Llama3.1 based llm component using ollama client</span>
<span class="linenos">13</span><span class="n">llama</span> <span class="o">=</span> <span class="n">Llama3_1</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llama&quot;</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">llama_client</span> <span class="o">=</span> <span class="n">OllamaClient</span><span class="p">(</span><span class="n">llama</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1"># Initialize a vector DB that will store our routes</span>
<span class="linenos">17</span><span class="n">chroma</span> <span class="o">=</span> <span class="n">ChromaDB</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MainDB&quot;</span><span class="p">)</span>
<span class="linenos">18</span><span class="n">chroma_client</span> <span class="o">=</span> <span class="n">HTTPDBClient</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">chroma</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="c1"># Define LLM input and output topics including goal_point topic of type PoseStamped</span>
<span class="linenos">21</span><span class="n">goto_in</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;goto_in&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">)</span>
<span class="linenos">22</span><span class="n">goal_point</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;goal_point&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="s2">&quot;PoseStamped&quot;</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="n">config</span> <span class="o">=</span> <span class="n">LLMConfig</span><span class="p">(</span><span class="n">enable_rag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">25</span>                   <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span>
<span class="linenos">26</span>                   <span class="n">distance_func</span><span class="o">=</span><span class="s2">&quot;l2&quot;</span><span class="p">,</span>
<span class="linenos">27</span>                   <span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">28</span>                   <span class="n">add_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="c1"># initialize the component</span>
<span class="linenos">31</span><span class="n">goto</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span>
<span class="linenos">32</span>    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">goto_in</span><span class="p">],</span>
<span class="linenos">33</span>    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">goal_point</span><span class="p">],</span>
<span class="linenos">34</span>    <span class="n">model_client</span><span class="o">=</span><span class="n">llama_client</span><span class="p">,</span>
<span class="linenos">35</span>    <span class="n">db_client</span><span class="o">=</span><span class="n">chroma_client</span><span class="p">,</span>  <span class="c1"># check the previous example where we setup this database client</span>
<span class="linenos">36</span>    <span class="n">trigger</span><span class="o">=</span><span class="n">goto_in</span><span class="p">,</span>
<span class="linenos">37</span>    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<span class="linenos">38</span>    <span class="n">component_name</span><span class="o">=</span><span class="s1">&#39;go_to_x&#39;</span>
<span class="linenos">39</span><span class="p">)</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="c1"># set a component prompt</span>
<span class="linenos">42</span><span class="n">goto</span><span class="o">.</span><span class="n">set_component_prompt</span><span class="p">(</span>
<span class="linenos">43</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;From the given metadata, extract coordinates and provide</span>
<span class="linenos">44</span><span class="s2">    the coordinates in the following json format:</span><span class="se">\n</span><span class="s2"> {&quot;position&quot;: coordinates}&quot;&quot;&quot;</span>
<span class="linenos">45</span><span class="p">)</span>
<span class="linenos">46</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="c1"># pre-process the output before publishing to a topic of msg_type PoseStamped</span>
<span class="linenos">49</span><span class="k">def</span> <span class="nf">llm_answer_to_goal_point</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="linenos">50</span>    <span class="c1"># extract the json part of the output string (including brackets)</span>
<span class="linenos">51</span>    <span class="c1"># one can use sophisticated regex parsing here but we&#39;ll keep it simple</span>
<span class="linenos">52</span>    <span class="n">json_string</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="linenos">53</span>    <span class="c1"># load the string as a json and extract position coordinates</span>
<span class="linenos">54</span>    <span class="c1"># if there is an error, return None, i.e. no output would be published to goal_point</span>
<span class="linenos">55</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">56</span>        <span class="n">json_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
<span class="linenos">57</span>        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="linenos">58</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coordinates Extracted:&#39;</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
<span class="linenos">59</span>        <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<span class="linenos">60</span>            <span class="k">return</span>
<span class="linenos">61</span>        <span class="k">elif</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># sometimes LLMs avoid adding the zeros of z-dimension</span>
<span class="linenos">62</span>            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">63</span>        <span class="k">return</span> <span class="n">coordinates</span>
<span class="linenos">64</span>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="linenos">65</span>        <span class="k">return</span>
<span class="linenos">66</span>
<span class="linenos">67</span>
<span class="linenos">68</span><span class="c1"># add the pre-processing function to the goal_point output topic</span>
<span class="linenos">69</span><span class="n">goto</span><span class="o">.</span><span class="n">add_publisher_preprocessor</span><span class="p">(</span><span class="n">goal_point</span><span class="p">,</span> <span class="n">llm_answer_to_goal_point</span><span class="p">)</span>
<span class="linenos">70</span>
<span class="linenos">71</span><span class="c1"># Launch the component</span>
<span class="linenos">72</span><span class="n">launcher</span> <span class="o">=</span> <span class="n">Launcher</span><span class="p">()</span>
<span class="linenos">73</span><span class="n">launcher</span><span class="o">.</span><span class="n">add_pkg</span><span class="p">(</span>
<span class="linenos">74</span>    <span class="n">components</span><span class="o">=</span><span class="p">[</span><span class="n">goto</span><span class="p">]</span>
<span class="linenos">75</span>    <span class="p">)</span>
<span class="linenos">76</span><span class="n">launcher</span><span class="o">.</span><span class="n">bringup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="semantic_map.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Create a spatio-temporal semantic map</p>
      </div>
    </a>
    <a class="right-next"
       href="tool_calling.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Use Tool Calling in Go-to-X</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-the-component">Initialize the component</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-process-the-model-output-before-publishing">Pre-process the model output before publishing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#launching-the-components">Launching the Components</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Automatika Robotics
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2025, Automatika Robotics.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>